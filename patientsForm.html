<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blood Request Form</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    /* Sidebar styles - Green Theme */
    .sidebar {
          width: 250px;
          min-height: 100vh;
          background: linear-gradient(to bottom, #16a34a, #15803d);
          color: white;
          position: fixed;
          top: 0;
          left: 0;
          transition: all 0.3s;
          z-index: 100;
    }
    
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-menu {
      padding: 20px 0;
    }
    
    .sidebar-menu a {
      display: block;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
      border-left: 4px solid transparent;
    }
    
    .sidebar-menu a:hover {
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid white;
    }
    
    .sidebar-menu a.active {
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid white;
    }
    
    .sidebar-menu i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .main-content {
      margin-left: 250px;
      padding: 2rem;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      font-size: 1.15rem;
      background-color: #fffdf7;
      color: #222;
    }

    :root {
            --primary-500: #22c55e;
            --primary-600: #16a34a;
            --primary-700: #15803d;
            --primary-light: #dcfce7;
        }
        
        body {
            background: linear-gradient(135deg, #f0fdf4 0%, var(--primary-light) 100%);
            min-height: 100vh;
        }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      font-size: 1.1rem;
      padding: 0.8em;
      width: 100%;
      box-sizing: border-box;
    }

    label {
      font-size: 1.1rem;
      text-align: left;
    }

    table {
      width: 100%;
    }

    table td {
      padding: 16px 20px;
      vertical-align: top;
    }

    td label {
      display: block;
      margin-bottom: 6px;
      text-align: left;
    }

    td input:not([type="radio"]),
    td select {
      display: block;
      margin: 0 auto;
    }

    #gender-group {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-top: 6px;
    }

    #gender-group label {
      display: inline;
      margin-bottom: 0;
      text-align: left;
    }

    .header {
      background-color: lightgray;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
    }

    .title {
      text-align: center;
      flex: 1;
    }

    .title h1 {
      margin: 0;
      font-size: 2.2rem;
      font-weight: bold;
      margin-left:150px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .logo h1 {
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }

    form {
      display: flex;
      flex-direction: column;
      margin: 0 auto;
      width: 75vw;
    }

    fieldset {
      margin: 25px 0;
      padding: 25px 15px 20px 15px;
      border: 1px solid #999;
      position: relative;
    }

    legend {
      font-weight: bold;
      font-size: 1.2rem;
      padding: 0 10px;
      background-color: white;
      margin-left: 10px;
    }

    .submit-btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      width: fit-content;
      margin: 40px auto 50px auto;
      font-size: 1.1rem;
    }

    /* NEW: Improved Blood Group Inventory Status Styles */
    .inventory-status {
      margin-top: 40px;
      background-color: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .inventory-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .inventory-header h3 {
      margin: 0;
      font-size: 1.5rem;
      color: #333;
      display: flex;
      align-items: center;
    }

    .inventory-header svg {
      margin-right: 12px;
      color: #dc2626;
    }

    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .inventory-card {
      border-radius: 10px;
      padding: 20px;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 1px solid #e5e7eb;
      transition: transform 0.2s ease;
    }

    .inventory-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }

    .blood-type {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #1e293b;
    }

    .donor-count {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #475569;
    }

    .inventory-level {
      height: 10px;
      background-color: #f1f5f9;
      border-radius: 5px;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .inventory-fill {
      height: 100%;
      border-radius: 5px;
    }

    .status {
      font-size: 0.9rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 20px;
      display: inline-block;
    }

    /* Status Colors */
    .critical {
      border-left: 4px solid #dc2626;
    }
    .critical .inventory-fill {
      background-color: #dc2626;
    }
    .critical .status {
      background-color: #fee2e2;
      color: #b91c1c;
    }

    .low {
      border-left: 4px solid #d97706;
    }
    .low .inventory-fill {
      background-color: #d97706;
    }
    .low .status {
      background-color: #fef3c7;
      color: #92400e;
    }

    .adequate {
      border-left: 4px solid #16a34a;
    }
    .adequate .inventory-fill {
      background-color: #16a34a;
    }
    .adequate .status {
      background-color: #dcfce7;
      color: #166534;
    }

    .good {
      border-left: 4px solid #2563eb;
    }
    .good .inventory-fill {
      background-color: #2563eb;
    }
    .good .status {
      background-color: #dbeafe;
      color: #1e40af;
    }

    /* Special indicators for universal types */
    .universal-donor {
      position: relative;
    }
    .universal-donor::after {
      content: "Universal Donor";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 0.75rem;
      background-color: #fee2e2;
      color: #b91c1c;
      padding: 2px 8px;
      border-radius: 10px;
    }

    .universal-receiver {
      position: relative;
    }
    .universal-receiver::after {
      content: "Universal Receiver";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 0.75rem;
      background-color: #dbeafe;
      color: #1e40af;
      padding: 2px 8px;
      border-radius: 10px;
    }

    .inventory-summary {
      grid-column: 1 / -1;
      background-color: #f8fafc;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid #e2e8f0;
    }

    .inventory-summary h4 {
      margin-top: 0;
      color: #1e293b;
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      .inventory-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      }
      .sidebar {
        width: 0;
        overflow: hidden;
      }
      .main-content {
        margin-left: 0;
      }
    }
    
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const hospitalId = sessionStorage.getItem('loggedInHospitalId');
      let hospitalState = '';

      if (hospitalId) {
        const hospitals = JSON.parse(localStorage.getItem('hospitals')) || [];
        const hospital = hospitals.find(h => h.id == hospitalId);

        if (hospital) {
          document.getElementById('hospitalName').textContent = hospital.name;
          hospitalState = hospital.state || (hospital.address && hospital.address.state) || '';
        }
      }

      const findDonorsBtn = document.getElementById('findDonorsBtn');
      if (findDonorsBtn) {
        findDonorsBtn.addEventListener('click', function () {
          const bloodType = document.getElementById('bloodType').value;
          if (!bloodType) {
            alert('Please select a blood type');
            return;
          }
          
          findMatchingDonors(bloodType, hospitalState);
        });
      }

      // Load and display inventory status
      updateInventoryStatus();

      // Logout functionality
      document.getElementById("logoutBtn").addEventListener("click", function(e) {
        e.preventDefault();
        sessionStorage.removeItem('loggedInHospitalId');
        window.location.href = "hospital_login.html";
      });
    });

    function findMatchingDonors(bloodType, hospitalState) {
      const donors = JSON.parse(localStorage.getItem('donors')) || [];
      let matchingDonors = [];
      let otherStateDonors = [];
      let headerMessage = '';
      
      // Get units needed and blood product type
      const unitsNeeded = document.getElementById('units-needed').value;
      const bloodProduct = document.getElementById('blood-product').value;
      const urgencyLevel = document.getElementById('urgency').value;
      // Get universal donors preference
      const prioritizeUniversalDonors = document.getElementById('prioritize-universal-donors').checked;
      
      // For AB+ (universal receiver), show all blood types
      if (bloodType === 'AB+') {
        // Filter donors by state
        if (hospitalState) {
          matchingDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donorState.toLowerCase() === hospitalState.toLowerCase();
          });
          
          // Filter donors from other states
          otherStateDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donorState.toLowerCase() !== hospitalState.toLowerCase();
          });
        } else {
          matchingDonors = donors;
        }
        
        headerMessage = `Donors for AB+ Blood Type (Universal Receiver - Can Receive Any Blood Type)`;
      } else {
        // Find donors matching the selected blood type
        if (hospitalState) {
          matchingDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donor.bloodGroup === bloodType &&
              donorState.toLowerCase() === hospitalState.toLowerCase();
          });
          
          // Filter other state donors with matching blood type
          otherStateDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donor.bloodGroup === bloodType &&
              donorState.toLowerCase() !== hospitalState.toLowerCase();
          });
        } else {
          matchingDonors = donors.filter(donor => donor.bloodGroup === bloodType);
        }
        
        // Always include O- donors (universal donors) if selected blood type is not already O- and option is checked
        if (bloodType !== 'O-' && prioritizeUniversalDonors) {
          const universalDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donor.bloodGroup === 'O-' &&
              (!hospitalState || donorState.toLowerCase() === hospitalState.toLowerCase());
          });
          
          // Universal donors from other states
          const otherStateUniversalDonors = donors.filter(donor => {
            const donorState = donor.state || (donor.address && donor.address.state) || '';
            return donor.bloodGroup === 'O-' &&
              hospitalState && donorState.toLowerCase() !== hospitalState.toLowerCase();
          });
          
          if (universalDonors.length > 0) {
            // Combine both donor lists (avoiding duplicates by using ids)
            const allDonorIds = new Set(matchingDonors.map(d => d.id));
            universalDonors.forEach(donor => {
              if (!allDonorIds.has(donor.id)) {
                matchingDonors.push(donor);
              }
            });
          }
          
          if (otherStateUniversalDonors.length > 0) {
            // Add other state O- donors to otherStateDonors list
            const allOtherStateDonorIds = new Set(otherStateDonors.map(d => d.id));
            otherStateUniversalDonors.forEach(donor => {
              if (!allOtherStateDonorIds.has(donor.id)) {
                otherStateDonors.push(donor);
              }
            });
          }
        }
        
        headerMessage = bloodType === 'O-' ? 
          `Donors with O- Blood Type (Universal Donors)` : 
          (prioritizeUniversalDonors ? `Donors with ${bloodType} Blood Type + Universal Donors (O-)` : `Donors with ${bloodType} Blood Type`);
      }

      // Sort donors to group by blood type
      matchingDonors.sort((a, b) => a.bloodGroup.localeCompare(b.bloodGroup));
      
      // Sort other state donors alphabetically by state and then by blood type
      otherStateDonors.sort((a, b) => {
        const stateA = a.state || (a.address && a.address.state) || '';
        const stateB = b.state || (b.address && b.address.state) || '';
        if (stateA !== stateB) {
          return stateA.localeCompare(stateB);
        }
        return a.bloodGroup.localeCompare(b.bloodGroup);
      });

      const resultsSection = document.getElementById('donorsResults');
      resultsSection.style.display = 'block';

      document.getElementById('resultsHeading').textContent = headerMessage;

      const donorsList = document.getElementById('donorsList');
      if (matchingDonors.length > 0 || otherStateDonors.length > 0) {
        // Add an info message for AB+ (universal receiver)
        let infoMessage = '';
        if (bloodType === 'AB+') {
          infoMessage = `
            <div style="grid-column: 1/-1; text-align: center; margin-bottom: 20px; background-color: #cce5ff; padding: 15px; border-radius: 8px; border: 1px solid #b8daff;">
              <p style="margin: 0; font-size: 16px; color: #004085;">
                <strong>Universal Receiver Information:</strong> AB+ blood type can receive donations from all other blood types, making AB+ patients "universal receivers."
              </p>
            </div>
          `;
        }

        // Create local state donors section
        let localDonorsHTML = '';
        if (matchingDonors.length > 0) {
          localDonorsHTML = matchingDonors.map(donor => `
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: white;">
              <div><strong>Name:</strong> ${donor.name || 'N/A'}</div>
              <div style="color: ${getBloodTypeColor(donor.bloodGroup)}; font-weight: bold;">
                <strong>Blood Group:</strong> ${donor.bloodGroup || 'N/A'} 
                ${getBloodTypeLabel(donor.bloodGroup)}
              </div>
              <div><strong>Contact:</strong> ${donor.contact || 'N/A'}</div>
              <div><strong>Email:</strong> ${donor.email || 'N/A'}</div>
              <div><strong>City:</strong> ${donor.city || (donor.address && donor.address.city) || 'N/A'}</div>
              <div><strong>State:</strong> ${donor.state || (donor.address && donor.address.state) || 'N/A'}</div>
              <a href="send_message.html?id=${donor.id}&bloodType=${bloodType}&unitsNeeded=${unitsNeeded}&urgency=${urgencyLevel}&bloodProduct=${bloodProduct}" 
                 style="display: block; width: 100%; padding: 8px; background-color: #28a745; color: white; text-align: center; border-radius: 4px; margin-top: 10px; text-decoration: none;">
                Contact Donor
              </a>
            </div>
          `).join('');
        } else {
          localDonorsHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
              <p style="margin: 0; font-size: 16px; color: #6c757d;">No donors found with ${bloodType} blood type${prioritizeUniversalDonors ? ' or O- universal donors' : ''} in your state.</p>
            </div>
          `;
        }
        
        // Create other states donors section
        let otherStatesDonorsHTML = '';
        if (otherStateDonors.length > 0) {
          otherStatesDonorsHTML = `
            <div style="grid-column: 1/-1; margin-top: 30px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">Donors from Other States</h3>
                <div>
                  <label style="margin-right: 10px; display: inline-flex; align-items: center;">
                    <input type="checkbox" id="showOtherStates" checked style="margin-right: 5px;"> Show donors from other states
                  </label>
                </div>
              </div>
              <div id="otherStatesDonorsContainer" style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                  ${otherStateDonors.map(donor => {
                    const donorState = donor.state || (donor.address && donor.address.state) || 'Unknown';
                    const isUniversalDonor = donor.bloodGroup === 'O-';
                    return `
                      <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: white; border-left: 4px solid ${isUniversalDonor ? '#dc3545' : '#3b82f6'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                          <div style="font-weight: bold;">${donor.name || 'N/A'}</div>
                          <div style="color: ${getBloodTypeColor(donor.bloodGroup)}; font-weight: bold; background-color: ${isUniversalDonor ? '#fef2f2' : '#eff6ff'}; padding: 3px 8px; border-radius: 12px;">
                            ${donor.bloodGroup || 'N/A'} ${getBloodTypeLabel(donor.bloodGroup)}
                          </div>
                        </div>
                        <div><strong>Contact:</strong> ${donor.contact || 'N/A'}</div>
                        <div><strong>City:</strong> ${donor.city || (donor.address && donor.address.city) || 'N/A'}</div>
                        <div><strong>State:</strong> <span style="background-color: #dbeafe; padding: 2px 6px; border-radius: 4px;">${donorState}</span></div>
                        <a href="send_message.html?id=${donor.id}&bloodType=${bloodType}&unitsNeeded=${unitsNeeded}&urgency=${urgencyLevel}&bloodProduct=${bloodProduct}" 
                           style="display: block; width: 100%; padding: 8px; background-color: #4f46e5; color: white; text-align: center; border-radius: 4px; margin-top: 10px; text-decoration: none;">
                          Contact Donor
                        </a>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            </div>
          `;
        }

        // Combine sections
        donorsList.innerHTML = infoMessage + localDonorsHTML + otherStatesDonorsHTML;
        
        // Add toggle functionality for other states section
        const showOtherStatesCheckbox = document.getElementById('showOtherStates');
        if (showOtherStatesCheckbox) {
          const otherStatesDonorsContainer = document.getElementById('otherStatesDonorsContainer');
          showOtherStatesCheckbox.addEventListener('change', function() {
            if (otherStatesDonorsContainer) {
              otherStatesDonorsContainer.style.display = this.checked ? 'block' : 'none';
            }
          });
        }
      } else {
        donorsList.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
            <p style="margin: 0; font-size: 16px; color: #6c757d;">No donors found with ${bloodType} blood type${prioritizeUniversalDonors ? ' or O- universal donors' : ''}.</p>
          </div>
        `;
      }
    }
    
    // Helper function to get color based on blood type
    function getBloodTypeColor(bloodType) {
      if (bloodType === 'O-') return '#dc3545'; // Red for universal donor
      if (bloodType === 'AB+') return '#0d6efd'; // Blue for universal receiver
      return '#28a745'; // Green for other blood types
    }
    
    // Helper function to get label based on blood type
    function getBloodTypeLabel(bloodType) {
      if (bloodType === 'O-') return '(Universal Donor)';
      if (bloodType === 'AB+') return '(Universal Receiver)';
      return '';
    }

    // Function to update inventory status
    function updateInventoryStatus() {
      const donors = JSON.parse(localStorage.getItem('donors')) || [];
      const bloodTypes = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
      
      // Count donors by blood type
      const inventory = {};
      bloodTypes.forEach(type => {
        inventory[type] = donors.filter(donor => donor.bloodGroup === type).length;
      });
      
      // Determine status for each blood type
      const inventoryContainer = document.getElementById('inventoryStatus');
      inventoryContainer.innerHTML = '';
      
      bloodTypes.forEach(type => {
        const count = inventory[type];
        let statusClass = '';
        let statusText = '';
        let fillPercentage = 0;
        
        // Determine status based on count
        if (count === 0) {
          statusClass = 'critical';
          statusText = 'Critical';
          fillPercentage = 5;
        } else if (count <= 2) {
          statusClass = 'critical';
          statusText = 'Very Low';
          fillPercentage = 20;
        } else if (count <= 5) {
          statusClass = 'low';
          statusText = 'Low';
          fillPercentage = 40;
        } else if (count <= 10) {
          statusClass = 'adequate';
          statusText = 'Adequate';
          fillPercentage = 70;
        } else {
          statusClass = 'good';
          statusText = 'Good';
          fillPercentage = 100;
        }
        
        // Special case for O- (universal donor)
        if (type === 'O-' && count <= 3) {
          statusClass = 'critical';
          statusText = 'Urgent Need';
          fillPercentage = 15;
        }
        
        // Create inventory card
        const card = document.createElement('div');
        card.className = `inventory-card ${statusClass} ${type === 'O-' ? 'universal-donor' : ''} ${type === 'AB+' ? 'universal-receiver' : ''}`;
        card.innerHTML = `
          <div class="blood-type">${type}</div>
          <div class="donor-count">${count} donors</div>
          <div class="inventory-level">
            <div class="inventory-fill" style="width: ${fillPercentage}%"></div>
          </div>
          <div class="status">${statusText}</div>
        `;
        
        inventoryContainer.appendChild(card);
      });
      
      // Add summary message
      const criticalTypes = bloodTypes.filter(type => {
        const count = inventory[type];
        return (type === 'O-' && count <= 3) || (type !== 'O-' && count <= 2);
      });
      
      if (criticalTypes.length > 0) {
        const summary = document.createElement('div');
        summary.className = 'inventory-summary';
        summary.innerHTML = `
          <h4>Urgent Blood Needs</h4>
          <p>The following blood types are in critical need: <strong>${criticalTypes.join(', ')}</strong>.</p>
          ${criticalTypes.includes('O-') ? '<p>O- (Universal Donor) is especially critical as it can be used for all patients in emergencies.</p>' : ''}
        `;
        
        inventoryContainer.appendChild(summary);
      }
    }
  </script>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <a href="homepage.html" class="text-2xl font-bold text-white">DonorSync</a>
    </div>
    
    <div class="sidebar-menu">
      <a href="homepage.html">
        <i class="fas fa-home"></i> Home
      </a>
      <a href="hospital.html">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </a>
      <a href="patientsForm.html" class="active">
        <i class="fas fa-user-injured"></i> Make a Request
      </a>
      <a href="#" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <header>
      <div class="header">
        <div class="title">
          <h1>Blood Request Form</h1>
        </div>
        <div class="logo">
          <h1 id="hospitalName"><a href="hospital.html">Hospital Name</a></h1>
        </div>
      </div>
    </header>

    <main>
      <form id="donorSearchForm" onsubmit="return false;">
        <fieldset id="medical-request">
          <legend>Patient Medical Request</legend>
          <div class="form-row">
            <div class="form-group">
              <label for="bloodType">Required Blood Type:</label>
              <select id="bloodType" name="bloodType" required>
                <option value="">Select blood type</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="units-needed">Units Needed:</label>
              <input type="number" id="units-needed" name="units-needed" min="1" value="1" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="urgency">Urgency Level:</label>
              <select id="urgency" name="urgency" required>
                <option value="routine">Routine</option>
                <option value="urgent">Urgent</option>
                <option value="emergency">Emergency</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="blood-product">Type of Blood Product:</label>
              <select id="blood-product" name="blood-product" required>
                <option value="wholeBlood">Whole Blood</option>
                <option value="redCells">Red Blood Cells</option>
                <option value="plasma">Plasma</option>
                <option value="platelets">Platelets</option>
              </select>
            </div>
          </div>

          <!-- Universal Donors Section -->
          <div id="universalDonorsSection" style="margin-top: 20px; padding: 15px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
            <h4 style="color: #721c24; margin-top: 0;">Universal Donors (O-) Priority System</h4>
            <div style="display: flex; align-items: flex-start;">
              <div style="flex: 3;">
                <p style="margin-top: 0;">O- blood type donors are <strong>universal donors</strong> who can donate to any recipient regardless of blood type. In emergency situations where there's no time to match blood types, O- blood is critical.</p>
                <div style="display: flex; align-items: center; margin-top: 10px;">
                  <label for="prioritize-universal-donors" style="margin-right: 10px; font-weight: bold;">Include O- donors in search results:</label>
                  <input type="checkbox" id="prioritize-universal-donors" name="prioritize-universal-donors" checked style="transform: scale(1.2);">
                </div>
              </div>
              <div style="flex: 2; padding-left: 15px;">
                <div style="background-color: #fff; border-radius: 6px; padding: 10px; font-size: 14px;">
                  <div style="text-align: center; font-weight: bold; margin-bottom: 5px;">Blood Type Compatibility</div>
                  <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <tr>
                      <td style="padding: 3px; text-align: center; background-color: #e9ecef; font-weight: bold;">O-</td>
                      <td style="padding: 3px;">Can donate to all blood types</td>
                    </tr>
                    <tr>
                      <td style="padding: 3px; text-align: center; background-color: #e9ecef; font-weight: bold;">AB+</td>
                      <td style="padding: 3px;">Can receive from all blood types</td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 20px; text-align: center;">
            <button type="button" id="findDonorsBtn" class="btn btn-primary">Find Matching Donors</button>
          </div>
        </fieldset>
      </form>

      <div id="donorsResults" style="margin-top: 30px; display: none;">
        <h3 id="resultsHeading">Matching Donors</h3>
        <div id="donorsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;"></div>
      </div>
      
      <!-- Blood Group Inventory Status Section -->
      <div class="inventory-status">
        <div class="inventory-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 3h18v18H3z"></path>
            <path d="M7 16h10"></path>
            <path d="M7 12h10"></path>
            <path d="M7 8h10"></path>
          </svg>
          <h3>Blood Group Inventory Status</h3>
        </div>
        <p>Current availability of donors by blood type in our system:</p>
        
        <div id="inventoryStatus" class="inventory-grid">
          <!-- Inventory cards will be inserted here by JavaScript -->
        </div>
      </div>
    </main>
  </div>
</body>
</html>